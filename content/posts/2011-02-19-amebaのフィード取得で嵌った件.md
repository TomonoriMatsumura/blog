---
title: Amebaのフィード取得で嵌った件
author: tomonori
type: post
date: 2011-02-19T08:35:22+00:00
url: /?p=215
categories:
  - PHP
  - 開発メモ

---
CURLライブラリのマルチ機能を試そうと思い、AKB48のメンバーブログのフィードの一気解析を実行。

// フィードURLの設定
  
$arFeedUrl = array(
  
&#8216;http://gdata.youtube.com/feeds/base/videos?q=AKB48&alt=rss&client=ytapi-youtube-search&v=2&#8217;,
  
&#8216;http://rssblog.ameba.jp/akihabara48/rss20.xml&#8217;,
  
&#8216;http://gdata.youtube.com/feeds/base/users/AKB48/uploads?alt=rss&v=2&orderby=published&client=ytapi-youtube-profile&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/watarirouka/index1_0.rdf&#8217;,
  
&#8216;http://blog.watanabepro.co.jp/ooyashizuka/index.xml&#8217;,

&#8216;http://rssblog.ameba.jp/harukatayama/rss20.xml&#8217;,

&#8216;http://blog.watanabepro.co.jp/kuramochiasuka/index.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/no3b/index1_0.rdf&#8217;,
  
&#8216;http://rssblog.ameba.jp/sashihara-rino/rss20.xml&#8217;,
  
&#8216;http://blog.mariko-shinoda.net/index.rdf&#8217;,
  
&#8216;http://blog.watanabepro.co.jp/takajoaki/index.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/no3b/index1_0.rdf&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/watarirouka/index1_0.rdf&#8217;,
  
&#8216;http://rssblog.ameba.jp/nakata-chisato/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/nakaya-sayaka/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/atsuko-maeda/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/amimaeda-blog/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/xanadu11/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/uchidamayumi/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/oshima-y/rss20.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/watarirouka/index1_0.rdf&#8217;,
  
&#8216;http://rssblog.ameba.jp/tanabe-miku/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/nakatsuka-tomomi/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/nitomoenoblog/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/reina-fujie/rss20.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/no3b/index1_0.rdf&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/rumifu-blog/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/ishidaharuka-blog/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/xanadu48/rss20.xml&#8217;,
  
&#8216;http://twitter.com/statuses/user_timeline/79973281.rss&#8217;,
  
&#8216;http://blog.watanabepro.co.jp/kashiwagiyuki/index.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/kitahara-rie/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/withamina/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/satosumire/rss20.xml&#8217;,
  
&#8216;http://blog.watanabepro.co.jp/satounatsuki/index.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/mariyasuzuki/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/chikano-rina/rss20.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/watarirouka/index1_0.rdf&#8217;,
  
&#8216;http://rssblog.ameba.jp/akimoto100323/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/xanadu30/rss20.xml&#8217;,
  
&#8216;http://blog-cdn.oricon.co.jp/watarirouka/index1_0.rdf&#8217;,
  
&#8216;http://www.ske48.co.jp/rss/today.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/ske48official/rss20.xml&#8217;,
  
&#8216;http://rssblog.ameba.jp/sdn48official/rss20.xml&#8217;,
  
&#8216;http://www.dmm.com/akb48/-/list/=/shop=akb48/sort=date/rss=create/_jloff=1&#8217;,
  
&#8216;http://ch.nicovideo.jp/video/ch480?rss=2.0&#8217;,
  
&#8216;http://jbbs.livedoor.jp/bbs/subject.cgi/music/16148/rss&#8217;
  
);

CURL\_multiでコンテンツを取得し、いざsimplexml\_load_stringで解析を試みると

Warning: simplexml\_load\_string() [function.simplexml-load-string]: Entity: line 1: parser error : Space required after the Public Identifier

と言うエラーが出て、フィードが取得出来ない。最初simplexml\_load\_stringにCURLで引っ張ってきたテキストデータを読み込む時に勝手にPHP側で整形しているのかもと思い、色々調べる。DOMの読み込みの時嵌った覚えがあったから。

しかし結局Ameblo側でフィードのURLをRedirectしていた事が判明。CURL先生にリダイレクトしてもらい、追っかけをやってもらう。

curl\_setopt($arCurl[$i], CURLOPT\_RETURNTRANSFER, true);
  
curl\_setopt($arCurl[$i], CURLOPT\_FOLLOWLOCATION, true);
  
curl\_setopt($arCurl[$i], CURLOPT\_MAXREDIRS, 1);

いや、しかしリダイレクトで追っかけを指示すると、マルチの効果が半減であんまりスピード出ない（泣）。