---
title: 公開鍵秘密鍵を設定する
author: tomonori
type: post
date: 2013-02-03T02:22:14+00:00
url: /?p=663
categories:
  - CentOS6
  - SSH

---
<p style="text-align: right;">
  [Redmine参照](/redmine/issues/190)
</p>

VNC環境で立ち上げたEclipseからEgitで外部gitリポジトリにアクセスする必要が出てきたのでOpenSSHの設定をもう一度見直す

### キーペアを作成する

接続先のサーバでキーペアを作成する。SSH接続時は **.sshディレクトリ** のアクセス権限は**700**、公開鍵、秘密鍵は**600**にしておかないとエラーになる。

```:bash
ssh-keygen -t rsa
mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

### ログイン設定をする

パスワードでログイン出来ないようにし、秘密鍵のみでログイン出きるように変更する

```:bash
vi /etc/ssh/sshd_config

# 以下の行のコメントを外して保存
PubkeyAuthentication yes
PasswordAuthentication no

# SSH のサービスを再起動
/etc/init.d/sshd restart
```

### SSHの接続ポートを変更する

ディフォルトだとポート番号22番からの接続をSSH接続ポートとして設定してある。このままだとボットからの攻撃があり余分にリソースが喰われる可能性があるのでポート番号を変更しておく。

```:bash
vi /etc/ssh/sshd_config
Port {sshport_number} # 0～65535の間で設定
vi /etc/sysconfig/iptables
# 以下を追加
-A INPUT -m state --state NEW -m tcp -p tcp --dport {sshport_number} -j ACCEPT
# sshd、iptablesを再起動する
service sshd restart
/etc/rc.d/init.d/iptables restart
```

### ローカルに秘密鍵を保存する

何らかの方法でローカルに秘密鍵を保存しアクセス権限を適宜設定する。またSSH接続したいサーバが複数ある場合は~/.sshにconfigファイルを作成し設定を行う

```:bash
# ローカルPCで操作する
cd ~/.ssh
chmod 600 id_rsa
vi config
# 以下の設定を書き込む
Host example.com
  User sshuser
  Port {sshport_number}
  Hostname example.com
  IdentityFile ~/.ssh/id_rsa-sshuser@example.com

# アクセス権限を変更する
chmod 600 config
mv id_rasa id_rsa-sshuser\@example.com
```

これでSSH接続出きるようになる

### 参考サイト

  * [CentOS で公開鍵暗号方式を使用した SSH ログイン設定: あるＳＥのつぶやき][1]
  * [ssh用のポート番号を変更する | マニュアル｜ServersMan@VPS Entry/Standard/Proプラン｜仮想専用サーバー｜クラウドサービス：ユビキタスプロバイダ　DTI][2]
  * [sshdのログファイルの確認方法 | Yukun&#8217;s Blog][3]
  * [秘密鍵が複数ある場合の設定(OpenSSH)ユニキャストラボ | ユニキャストラボ][4]

 [1]: http://fnya.cocolog-nifty.com/blog/2012/03/centos-ssh-8291.html
 [2]: http://dream.jp/vps/esp/manual/mnl_security_03.html
 [3]: http://www.yukun.info/blog/2008/06/sshd-log-file.html
 [4]: http://lab.unicast.ne.jp/2011/09/11/%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%8C%E8%A4%87%E6%95%B0%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E8%A8%AD%E5%AE%9Aopenssh-2/