---
title: CentOS7でSSHを秘密鍵公開鍵を使って設定する
author: tomonori
type: post
date: 2015-11-17T13:59:06+00:00
url: /?p=1084
categories:
  - CentOS7
  - SSH

---
### キーペアを作成する

接続元の端末でキーペアを作成する。作成した公開鍵を接続サーバの接続アカウントに置く。SSH接続時は **.sshディレクトリ** のアクセス権限は**700**、公開鍵、秘密鍵は**600**にしておかないとエラーになる。

```:bash
# 接続元端末で
ssh-keygen -t rsa

# 接続先で
mkdir ~/.ssh
vi ~/.ssh/authorized_keys # 公開鍵を書き込む
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

### ログイン設定をする

パスワードでログイン出来ないようにし、秘密鍵のみでログイン出きるように変更する

```:bash
vi /etc/ssh/sshd_config

# 以下の行のコメントを外して保存
PubkeyAuthentication yes
PasswordAuthentication no
PermitRootLogin no

# SSH のサービスを再起動
systemctl restart sshd.service
```

### SSHの接続ポートを変更する

ディフォルトだとポート番号22番からの接続をSSH接続ポートとして設定してある。このままだとボットからの攻撃があり余分にリソースが喰われる可能性があるのでポート番号を変更しておく。

```:bash
vi /etc/ssh/sshd_config

Port XXXXX # 0～65535の間で設定

# Firewallの設定を行う
firewall-cmd --permanent --add-port=XXXXX/tcp
firewall-cmd --reload

# SSHの設定を反映する
systemctl restart sshd.service
```

### 参考サイト