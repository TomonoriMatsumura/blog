---
title: さくらのVPSでVNCを起動する
author: tomonori
type: post
date: 2013-02-02T04:26:45+00:00
url: /?p=646
categories:
  - CentOS6
  - VNC
  - さくらのVPS

---
リモート開発をするのに、VNC経由の方が簡単なんじゃないかと思い、VNC環境を入れてみた。一応[このサイト][1]の手順通りで大体は環境構築が可能だと思う。

### 1. 必要なパッケージのインストール

#### サーバ

想定される環境だと、**tigervnc-server**と**デスクトップパッケージ**をインストールする必要がある。rpmからインストールする。

```:bash
yum install tigervnc-server
yum groupinstall "Desktop";
yum install -y gnome*  # システムモニターなどが使えるようになる このコマンドは無効化も知れない
yum groupinstall "Desktop" "Desktop Platform" "General Purpose Desktop"
yum groupinstall "X Window System";
```

CentOSを日本語化するには[こちら][2]を参考にする。

#### クライアント

こちらもrpmからインストール。インストールが完了すれば、デスクトップ→アプリケーション→インターネット→TigerVNC Viewverから起動可能になる。

```:bash
yum install vnc
```

### VNCサーバの設定

```:bash
vi /etc/sysconfig/vncservers
# 以下を追加 (画面ソリューションの「x」は小文字のxでないとエラーになるので注意！)
VNCSERVERS="1:vncuser"
VNCSERVERARGS[1]="-geometry 800x600"
```

複数ユーザを設定する場合は

```:bash
vi /etc/sysconfig/vncservers
# 以下を追加 (画面ソリューションの「x」は小文字のxでないとエラーになるので注意！)
VNCSERVERS="1:vncuser1 2:vncuser2"
VNCSERVERARGS[1]="-geometry 800x600"
VNCSERVERARGS[2]="-geometry 800x600"
```

### VNCユーザの設定

ログインユーザーをVNCユーザーに切り替えてパスワードを変更する

```:bash
su vncuser
vncpasswd &lt;enter&gt;
Password: ****** &lt;enter&gt;
Verify: ***** &lt;enter&gt;
```

### パケットフィルタリングの設定

想定される環境だとiptablesの設定ファイルが作成されていないので作成してアクセス制限をかける。以下の設定はポートだけ開放した状態。別途IPアドレス制限も設けた方が良いかもだが、テサリング時には逆に不便なので今回はポートのみ開放しておく。

```:bash
vi /etc/sysconfig/iptables
# Firewall configuration written by system-config-firewall
# Manual customization of this file is not recommended.
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
# 追記
-A INPUT -m state --state NEW -m tcp -p tcp -m multiport --dports 5901:5903,6001:6003 -j ACCEPT
# 追記終了
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
# iptablesサービスを再起動する
service iptables restart
```

### VNCサービスの起動

messagebusを起動させないと『**Failed to open connection to system message bus: Failed to connect to socket /var/run/dbus/system\_bus\_socket: No such file or directory**』と言うエラー文が出る場合がある。また、端末などが起動しなくなる場合がある。解決方法は[これ][3]っぽいが、とりあえずmessagebusを起動させる事で対応しておく。

```:bash
sudo service vncserver start
/etc/init.d/messagebus start
```

### クライアントからVNCを使う

F8でフルスクリーンモードの切り替え設定が可能になる

#### デスクトップから起動する

**デスクトップ**→**アプリケーション**→**インターネット**→**TigerVNC Viewver**

#### 端末から起動する</h3> 

```:bash
vncviewer yourhost:1
```

ポートフォワーディングについては[別エントリー][4]で。

### 参考サイト

  * [HowTos/VNC-Server &#8211; CentOS Wiki][1] 
      * [さくらのVPS を使いはじめる 3 &#8211; iptables を設定する | アカベコマイリ][5] 
          * [Shinya Blog: SpiderOak(DropBoxみたいなやつ)をServersMan@VPSで使ってみる][6] 
              * [VNC 4.1.1 Fullscreen exit?][7] 
                  * [さくらのVPSにCentOS6をインストール @ ともの技術メモ][3]
  
                    [CUIで入れたCentOS6にGUIを追加する &#8211; 東の森][8] </ul>

 [1]: http://wiki.centos.org/HowTos/VNC-Server
 [2]: ./?p=656
 [3]: http://tomono.eleho.net/2012/07/31/2913/
 [4]: ./?p=687
 [5]: http://akabeko.me/blog/2010/09/%E3%81%95%E3%81%8F%E3%82%89%E3%81%AEvps-%E3%82%92%E4%BD%BF%E3%81%84%E3%81%AF%E3%81%98%E3%82%81%E3%82%8B-3/
 [6]: http://shinya-blog.blogspot.jp/2011/11/spideroakdropboxvps.html
 [7]: http://www.realvnc.com/pipermail/vnc-list/2005-September/052277.html
 [8]: http://morrey22.hatenablog.com/entry/2013/04/14/212837