---
title: awkでSSHアクセス履歴を調べる
author: tomonori
type: post
date: 2015-11-17T13:18:29+00:00
url: /?p=1080
categories:
  - awk
  - SSH

---
SSHのアクセスログを定期的に調べる必要がある。

### ログインが成功したアクセスを調べる

```:bash
# アクセスが成功したログインを全て表示する
grep "Accepted" /var/log/secure*
# もしくは
grep "Accepted" /var/log/secure* | awk "{split($1, arr, ":"); print arr[2] $2 " " $3 " " $9 " " $11}" 

# 順にホワイトリストを当ててみて不正アクセスが無いか確認する
# 188.251.* はauのテザリング端末
# 221.1.36.239は自宅のインターネットプロバイダ
# 133.xxx.xxx.xxxは契約しているVPSサーバ
grep "Accepted" /var/log/secure* | awk "{print $9 " " $11}" | awk "{sub("/182.251.*/", ""); print $0;}" | awk "{sub("222.1.36.239", ""); print $0;}" | awk "{sub("133.xxx.xxx.xxx", ""); print $0;}"
```

### ログインが失敗したアクセスを調べる

```:bash
grep -E "Failed|Invalid" /var/log/secure*
```

### 参考サイト

  * [アクセスログ解析（ssh編） | tkd55 blog](http://www.tkd55.net/blog/?p=915)